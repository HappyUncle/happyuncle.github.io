[{"categories":["tidb"],"content":" è¯´æ˜æœ€è¿‘å‘ç° tidb æœ‰ä¸ª https://github.com/pingcap/TiProxy ä»“åº“ï¼ŒæŠ±ç€å¥½å¥‡çš„å¿ƒæ€æƒ³è¯•è¯•è¿™ä¸ªç»„ä»¶çš„ä½¿ç”¨æ•ˆæœã€‚äºæ˜¯æŒ‰ç…§æ–‡æ¡£çš„ä»‹ç»åœ¨æœ¬åœ°ç¯å¢ƒä½¿ç”¨tiupåšäº†ä¸€äº›å®éªŒï¼Œç°åœ¨å°†å®éªŒè¿‡ç¨‹å’Œå®éªŒç»“æœåˆ†äº«ç»™å¤§å®¶ã€‚ ","date":"2023-07-29","objectID":"/try-tiproxy/:1:0","series":null,"tags":["tidb","database"],"title":"TiProxy å°é²œ","uri":"/try-tiproxy/#è¯´æ˜"},{"categories":["tidb"],"content":" TiProxyä»‹ç»å®˜æ–¹READMEä»‹ç»çš„å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œæœ€é‡è¦çš„ç‰¹æ€§æ˜¯åœ¨TiDBå‡çº§ã€é‡å¯ã€æ‰©ç¼©èŠ‚ç‚¹æ—¶å€™å¯ä»¥ä¿è¯è¿æ¥ä¸æ–­ã€‚ç‰›ï¼ TiProxy is a database proxy that is based on TiDB. It keeps client connections alive while the TiDB server upgrades, restarts, scales in, and scales out. æ­¤å¤–è¿˜æœ‰ä¸€äº›ç‰¹æ€§ è¿æ¥ç®¡ç†ï¼š å½“tidbèŠ‚ç‚¹é‡å¯æˆ–è€…å…³æœºåï¼Œåœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šå»ºç«‹çš„è¿æ¥ä¼šè¿ç§»åˆ°å…¶ä»–å®ä¾‹ä¸Šï¼Œè¿™ä¸ªåŠ¨ä½œå¯¹clientæ˜¯é€æ˜çš„ï¼Œclientæ— æ„ŸçŸ¥ è´Ÿè½½å‡è¡¡ï¼š æ–°å»ºè¿æ¥ä¼šå¯¹åç«¯tidb-serverè¿›è¡Œæ‰“åˆ†ï¼Œç„¶åè¿›è¡Œå¤šä¸ªtidbå®ä¾‹é—´çš„å‡è¡¡ æœåŠ¡å‘ç°ï¼š TiProxy é€šè¿‡è·Ÿpdäº¤äº’è·å–æœ€æ–°çš„tidbå®ä¾‹ä¿¡æ¯ï¼Œå½“æœ‰æ–°çš„tidbå¯åŠ¨æ—¶ï¼Œproxyä¼šè‡ªåŠ¨å‘ç°å¹¶è¿ç§»è¿æ¥è‡³æ­¤ã€‚ ","date":"2023-07-29","objectID":"/try-tiproxy/:2:0","series":null,"tags":["tidb","database"],"title":"TiProxy å°é²œ","uri":"/try-tiproxy/#tiproxyä»‹ç»"},{"categories":["tidb"],"content":" å®éªŒè¯´æ˜ä½¿ç”¨tiupæ­å»ºä¸‹æµ‹è¯•ç¯å¢ƒï¼Œå¯åŠ¨1ä¸ªpdã€1ä¸ªtikvã€1ä¸ªtidb-serverã€1ä¸ªtiproxyï¼Œé€šè¿‡tiproxyè¿æ¥æ•°æ®åº“ï¼Œæµ‹è¯•caseå¦‚ä¸‹ï¼š å¯åŠ¨ä¸¤ä¸ªç»ˆç«¯è¿æ¥æ•°æ®åº“ï¼Œç„¶ååŠ 1ä¸ªtidb-serverèŠ‚ç‚¹ï¼Œçœ‹çœ‹clientæ— æ„Ÿçš„è´Ÿè´£å‡è¡¡æ•ˆæœ ä¸Šä¸€æ­¥å®Œæˆåï¼Œæˆ‘ä»¬æœ‰äº†2ä¸ªtidb-serverï¼Œé‚£ä¹ˆç¼©æ‰ä¸€ä¸ªï¼Œçœ‹çœ‹proxyæ˜¯æ€ä¹ˆåšåˆ°ä¼šè¯è¿ç§»çš„ ","date":"2023-07-29","objectID":"/try-tiproxy/:3:0","series":null,"tags":["tidb","database"],"title":"TiProxy å°é²œ","uri":"/try-tiproxy/#å®éªŒè¯´æ˜"},{"categories":["tidb"],"content":" å¯åŠ¨é›†ç¾¤æŸ¥é˜…èµ„æ–™ å‘ç°TiProxyä»…æ”¯æŒv6.4.0åŠä»¥åç‰ˆæœ¬ï¼Œæ‰€ä»¥ä½¿ç”¨tiupå¯åŠ¨è¿™ä¸ªç‰ˆæœ¬çš„é›†ç¾¤ã€‚ tidb å’Œ tiproxy ä½¿ç”¨ toekn è®¤è¯æ–¹å¼ï¼Œæ‰€ä»¥ç”Ÿæˆä¸€ä¸ªè¯ä¹¦ openssl req -x509 -newkey rsa:4096 -sha256 -days 3650 -nodes -keyout key.pem -out cert.pem -subj \"/CN=example.com\" å‡†å¤‡é…ç½®æ–‡ä»¶ tidb.toml å’Œ tiproxy.yaml $ cat tidb.toml graceful-wait-before-shutdown=10 [security] auto-tls=true session-token-signing-cert='/tmp/tiup/tiproxy/cert.pem' session-token-signing-key='/tmp/tiup/tiproxy/key.pem' $ cat tiproxy.yaml [proxy] require-backend-tls = false å¯åŠ¨tidb tiup playground v6.4.0 --db 1 --kv 1 --pd 1 --tiflash 0 --without-monitor --db.config tidb.toml å¯åŠ¨tiproxy tiup tiproxy:nightly --config tiproxy.yaml ","date":"2023-07-29","objectID":"/try-tiproxy/:4:0","series":null,"tags":["tidb","database"],"title":"TiProxy å°é²œ","uri":"/try-tiproxy/#å¯åŠ¨é›†ç¾¤"},{"categories":["tidb"],"content":" å®éªŒ","date":"2023-07-29","objectID":"/try-tiproxy/:5:0","series":null,"tags":["tidb","database"],"title":"TiProxy å°é²œ","uri":"/try-tiproxy/#å®éªŒ"},{"categories":["tidb"],"content":" 1ã€åŠ èŠ‚ç‚¹è‡ªåŠ¨è´Ÿè½½å‡è¡¡é›†ç¾¤å¯åŠ¨åï¼Œä½¿ç”¨ä¸¤ä¸ªç»ˆç«¯è¿æ¥proxyï¼Œç„¶åæ‰§è¡Œshow processlistå¯ä»¥çœ‹åˆ°å¯¹æ–¹çš„ä¼šè¯ï¼Œè¯´æ˜è¿æ¥åˆ°äº†ä¸€ä¸ªtidbèŠ‚ç‚¹ä¸Š æ‰§è¡Œtiupæ·»åŠ ä¸€ä¸ªtidb-serverèŠ‚ç‚¹ tiup playground scale-out --db 1 ç„¶ååˆ†åˆ«æ‰§è¡Œshow processlitæŸ¥è¯¢ï¼Œå‘ç°æ¯ä¸ªç»ˆç«¯çœ‹ä¸åˆ°å¯¹æ–¹çš„ä¼šè¯äº†ï¼Œè¯´æ˜å„è‡ªè¿æ¥åˆ°äº†ä¸€ä¸ªtidbå®ä¾‹ã€‚ ä»”ç»†æŸ¥çœ‹å‘ç°å…¶ä¸­ä¸€ä¸ªè¿æ¥çš„ä¿¡æ¯ä»127.0.0.1:53240å˜æˆäº†127.0.0.1:54328ï¼Œä¹Ÿç¡®å®è¯´æ˜å‘ç”Ÿäº†é‡è¿æ¥ã€‚ è¿™é‡Œè¡¥å……ä¸ªè¯´æ˜ï¼šå› ä¸ºæˆ‘æµ‹è¯•çš„æ—¶å€™æ²¡æœ‰å¼€å¯proxyåè®®ï¼Œæ‰€ä»¥show processlistçœ‹åˆ°çš„hostä¸æ˜¯clientçœŸå®çš„ä¿¡æ¯ï¼Œæ˜¯proxyå’Œtidbå»ºç«‹è¿æ¥çš„ä¿¡æ¯ï¼ŒtidbæŠŠproxyå½“æˆclientå‡ºæ¥äº†ã€‚ æµ‹è¯•ç»“æœå¾ˆå¥½ï¼Œè´Ÿè½½å‡è¡¡clientæ— æ„Ÿã€‚ ","date":"2023-07-29","objectID":"/try-tiproxy/:5:1","series":null,"tags":["tidb","database"],"title":"TiProxy å°é²œ","uri":"/try-tiproxy/#1åŠ èŠ‚ç‚¹è‡ªåŠ¨è´Ÿè½½å‡è¡¡"},{"categories":["tidb"],"content":" 2ã€ç¼©èŠ‚ç‚¹ä¼šè¯è‡ªåŠ¨è¿ç§»åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œæ‰§è¡Œtiupç¼©æ‰ä¸€ä¸ªtidb-server tiup playground scale-in --pid 91609 ç„¶åæ‰§è¡Œshow processlistï¼Œå¯ä»¥çœ‹åˆ°å¯¹æ–¹çš„ä¼šè¯ï¼Œè¯´æ˜åˆè¿æ¥åˆ°äº†åŒä¸€ä¸ªtidbèŠ‚ç‚¹ä¸Šã€‚ æ‰§è¡Œsqlçš„æ—¶å€™æ²¡æœ‰æŠ¥é”™ï¼Œclientæ— æ„ŸçŸ¥ã€‚ ","date":"2023-07-29","objectID":"/try-tiproxy/:5:2","series":null,"tags":["tidb","database"],"title":"TiProxy å°é²œ","uri":"/try-tiproxy/#2ç¼©èŠ‚ç‚¹ä¼šè¯è‡ªåŠ¨è¿ç§»"},{"categories":["tidb"],"content":" åŠ é¤å®éªŒè‡³æ­¤ä¸€åˆ‡éƒ½ä¸èˆ¬é¡ºæ»‘ã€ç¬¦åˆé¢„æœŸã€‚ä½†æ˜¯æµ‹è¯•çš„åœºæ™¯æœªå…æœ‰äº›ç®€å•ã€‚ä¸‹é¢åšä¸ªå¸¦æœ‰äº‹åŠ¡çš„caseï¼š ä½¿ç”¨tiupæ­å»ºä¸‹æµ‹è¯•ç¯å¢ƒï¼Œå¯åŠ¨1ä¸ªpdã€1ä¸ªtikvã€1ä¸ªtidb-serverã€1ä¸ªtiproxyï¼Œé€šè¿‡tiproxyè¿æ¥æ•°æ®åº“ï¼Œæ‰“å¼€ä¸¤ä¸ªç»ˆç«¯å¹¶æ˜¾ç¤ºæ‰§è¡Œä¸€ä¸ªbeginï¼Œç„¶ååˆ†åˆ«æ‰§è¡Œä¸ªå†™å…¥æ“ä½œï¼Œä¹‹åå†æ·»åŠ 1ä¸ªtidb-serverï¼Œçœ‹çœ‹ä¼šè¯æ˜¯å¦ä¼šè¢«è¿ç§»ã€‚ è¿™è¯´æ˜åœ¨æ‰§è¡Œä¸­çš„äº‹åŠ¡ä¸ä¼šåšè¿ç§»ã€‚åœ¨è®¾è®¡æ–‡æ¡£ ä¸­ä¹Ÿçš„ç¡®æœ‰è¿™æ ·çš„æè¿° Transactions are hard to be restored, so Session Manager doesnâ€™t support restoring a transaction. Session Manager must wait until the current transaction finishes or the TiDB instance exits due to shut down timeout. ç¬¦åˆé¢„æœŸã€‚ ","date":"2023-07-29","objectID":"/try-tiproxy/:6:0","series":null,"tags":["tidb","database"],"title":"TiProxy å°é²œ","uri":"/try-tiproxy/#åŠ é¤"},{"categories":["tidb"],"content":" æ€»ç»“æœ¬æ¬¡åŸºäºv6.4.0ç‰ˆæœ¬åšäº†3ä¸ªç®€å•çš„å®éªŒï¼Œå¯¹äºtidbèŠ‚ç‚¹æ‰©ç¼©æœ‰ä¼šè¯è‡ªåŠ¨è¿ç§»çš„èƒ½åŠ›çš„ç¡®å¾ˆä¸æ»‘ã€‚ æ•´ä¸ªè¿‡ç¨‹cleintæ— æŠ¥é”™ã€æ— æ„ŸçŸ¥ã€‚è¢«è¿ç§»çš„ä¼šè¯å¦‚æœæœ‰æœªæçš„äº‹åŠ¡ï¼Œåˆ™ä¼šç­‰åˆ°äº‹åŠ¡ç»“æŸåå†è¿ç§»ã€‚ èµğŸ‘ğŸ» ","date":"2023-07-29","objectID":"/try-tiproxy/:7:0","series":null,"tags":["tidb","database"],"title":"TiProxy å°é²œ","uri":"/try-tiproxy/#æ€»ç»“"},{"categories":["mysql-operator"],"content":" mysql-operator chart è¯´æ˜å®‰è£… mysql-operator çš„æ“ä½œå‘½ä»¤åœ¨å®˜æ–¹ä»“åº“å’Œå®˜ç½‘éƒ½æœ‰è¯´æ˜ï¼Œå…·ä½“å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š ## For Helm v3 helm repo add bitpoke https://helm-charts.bitpoke.io helm install mysql-operator bitpoke/mysql-operator åœ¨å®‰è£…çš„chartåŒ…ä¸­ï¼Œvalues.yamlæ–‡ä»¶æœ‰äº›å†…å®¹å¯ä»¥è‡ªå®šä¹‰é…ç½®ã€‚ å¦‚æœæƒ³è¦åœ¨ä¸€ä¸ªk8sé›†ç¾¤é‡Œé¢å¯åŠ¨å¤šä¸ªmysql-operatorï¼Œä¸æƒ³è®©ä¸ç”¨operatoräº’ç›¸å¹²æ‰°ï¼Œå°±å¯ä»¥æŒ‡å®šwatchNamespaceå‚æ•° å¦‚æœk8sé›†ç¾¤ä½¿ç”¨çš„storageClassä¸æ”¯æŒåŠ¨æ€è¿ç§»ï¼Œé‚£ä¹ˆoperatorçš„replicaCountå°±å¾—è®¾ç½®ä¸º3ï¼Œå¦åˆ™èŠ‚ç‚¹æŒ‚æ‰åæ— æ³•æ‹‰èµ·æ–°çš„pod å› ä¸ºmysqlé«˜å¯ç”¨æ˜¯åŸºäºorchestratorå®ç°çš„ï¼Œorchestratoråˆéœ€è¦ä¸€ä¸ªå…ƒæ•°æ®åº“ï¼Œå…ƒæ•°æ®åº“çš„è´¦å·å¯†ç å¯ä»¥é€šè¿‡ orchestrator.topologyUser å’Œ orchestrator.topologyPassword æŒ‡å®šã€‚topologyUseré»˜è®¤å€¼æ˜¯ orchestratorï¼Œå¦‚æœå¯†ç ä¸æŒ‡å®šä¼šéšæœºç”Ÿæˆ (å…¶ä»–å‚æ•°ä»¥åç”¨åˆ°å†è¯´æ˜)â€¦ â€¦ ","date":"2023-03-12","objectID":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/:1:0","series":null,"tags":["mysql","operator"],"title":"bitpoke/mysql-operator æŠ€æœ¯è§£è¯»ç³»åˆ— - éƒ¨ç½²","uri":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/#mysql-operator-chart-è¯´æ˜"},{"categories":["mysql-operator"],"content":" åœ¨æœ¬åœ°éƒ¨ç½² mysql-operator æ·»åŠ  repo $ helm repo add bitpoke https://helm-charts.bitpoke.io å®‰è£… mysql-operator å®‰è£…ä¹‹å‰å…ˆåˆ›å»ºä¸€ä¸ªnamespaceï¼Œç„¶åå°†mysql-operatorå®‰è£…åˆ°è¿™ä¸ªnsä¸­ $ kubectl create namespace mysql namespace/mysql created $ helm install mysql-operator bitpoke/mysql-operator -n mysql NAME: mysql-operator LAST DEPLOYED: Fri Mar 17 18:53:26 2023 NAMESPACE: mysql STATUS: deployed REVISION: 1 TEST SUITE: None NOTES: You can create a new cluster by issuing: cat \u003c\u003cEOF | kubectl apply -f- apiVersion: mysql.presslabs.org/v1alpha1 kind: MysqlCluster metadata: name: my-cluster spec: replicas: 1 secretName: my-cluster-secret --- apiVersion: v1 kind: Secret metadata: name: my-cluster-secret type: Opaque data: ROOT_PASSWORD: $(echo -n \"not-so-secure\" | base64) EOF æ‰§è¡ŒæˆåŠŸåï¼Œå¯ä»¥ç”¨kubectlå·¥å…·æŸ¥è¯¢podçŠ¶æ€ï¼Œç›´åˆ°Running $ kubectl get all -n mysql NAME READY STATUS RESTARTS AGE pod/mysql-operator-0 2/2 Running 1 3m11s NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE service/mysql-operator ClusterIP 10.102.117.142 \u003cnone\u003e 80/TCP,9125/TCP 9m1s service/mysql-operator-orc ClusterIP None \u003cnone\u003e 80/TCP,10008/TCP 9m1s NAME READY AGE statefulset.apps/mysql-operator 1/1 9m1s è‡³æ­¤ mysql-operator å°±ç®—å®‰è£…å®Œæˆäº†ã€‚ ","date":"2023-03-12","objectID":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/:2:0","series":null,"tags":["mysql","operator"],"title":"bitpoke/mysql-operator æŠ€æœ¯è§£è¯»ç³»åˆ— - éƒ¨ç½²","uri":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/#åœ¨æœ¬åœ°éƒ¨ç½²-mysql-operator"},{"categories":["mysql-operator"],"content":" mysql-operator ä¾èµ–èµ„æºè§£è¯»ä¸Šè¿°çš„å®‰è£…æµç¨‹æ­¥éª¤å¾ˆç®€å•ï¼Œä½†æ˜¯è¿è¡Œèµ·æ¥çš„mysql-operatorå¯¹æˆ‘ä»¬æ¥è¯´å°±æ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œä¸‹é¢é€šè¿‡æ‰§è¡Œ helm template å¯¹å…¶è¢«å®‰è£…çš„å†…å®¹è¿›è¡Œæ¢³ç†ã€‚ ","date":"2023-03-12","objectID":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/:3:0","series":null,"tags":["mysql","operator"],"title":"bitpoke/mysql-operator æŠ€æœ¯è§£è¯»ç³»åˆ— - éƒ¨ç½²","uri":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/#mysql-operator-ä¾èµ–èµ„æºè§£è¯»"},{"categories":["mysql-operator"],"content":" CRD èµ„æºCRD å…¨ç¨‹å«åš CustomResourceDefinitionï¼Œè¯¦ç»†ä¿¡æ¯å¯ä»¥ä»å®˜ç½‘è·å–ï¼Œè¿™é‡Œä¸è¿›è¡Œè§£é‡Šã€‚ $ helm template mysql-operator bitpoke/mysql-operator -n mysql --include-crds | grep -A 20 CustomResourceDefinition | grep -e kind kind: CustomResourceDefinition kind: MysqlBackup kind: CustomResourceDefinition kind: MysqlCluster kind: CustomResourceDefinition kind: MysqlDatabase kind: CustomResourceDefinition kind: MysqlUser ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œå®‰è£…mysql-operatorçš„æ—¶å€™ä¼šåˆ›å»º4ä¸ªCRDèµ„æºã€‚ä»åç§°å¯ä»¥çœ‹å‡ºæ˜¯åˆ†åˆ«æ˜¯å…³äºbackupã€clusterã€databaseã€user ç›¸å…³çš„ï¼Œä¹Ÿæ˜¯æœ¬ç³»åˆ—åœ¨åç»­ç¯‡ç« ä¸­è¦é‡ç‚¹è®²è§£çš„å†…å®¹ã€‚ ","date":"2023-03-12","objectID":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/:3:1","series":null,"tags":["mysql","operator"],"title":"bitpoke/mysql-operator æŠ€æœ¯è§£è¯»ç³»åˆ— - éƒ¨ç½²","uri":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/#crd-èµ„æº"},{"categories":["mysql-operator"],"content":" å…¶ä»–èµ„æºæŸ¥çœ‹ mysql-operator ä¾èµ–çš„å…¶ä»–èµ„æº $ helm template mysql-operator bitpoke/mysql-operator -n mysql | grep -e ^kind -e name | grep -A 1 ^kind kind: ServiceAccount name: mysql-operator -- kind: Secret name: mysql-operator-orc -- kind: ConfigMap name: mysql-operator-orc -- kind: ClusterRole name: mysql-operator -- kind: ClusterRoleBinding name: mysql-operator -- kind: Service name: mysql-operator-orc -- kind: Service name: mysql-operator -- kind: StatefulSet name: mysql-operator ä»ä¸Šå¯ä»¥çœ‹å‡ºï¼Œè®¡ç®—èµ„æºç”±StatefulSetç®¡ç†ï¼Œæœ‰2ä¸ªServiceèµ„æºï¼Œ1ä¸ªConfigMapï¼Œ1ä¸ªSecretã€‚å…¶ä½™3ä¸ªæ˜¯è·Ÿæƒé™ç®¡ç†ç›¸å…³çš„é…ç½®ã€‚ æ¥ä¸‹æ¥è¯¦ç»†èŠèŠæ¯ä¸ªèµ„æºçš„ä½œç”¨ã€‚ ","date":"2023-03-12","objectID":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/:3:2","series":null,"tags":["mysql","operator"],"title":"bitpoke/mysql-operator æŠ€æœ¯è§£è¯»ç³»åˆ— - éƒ¨ç½²","uri":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/#å…¶ä»–èµ„æº"},{"categories":["mysql-operator"],"content":" StatefulSethelm install å®‰è£…æ—¶çš„å†…å®¹å¦‚ä¸‹ï¼š # Source: mysql-operator/templates/statefulset.yaml apiVersion: apps/v1 kind: StatefulSet metadata: name: mysql-operator labels: helm.sh/chart: mysql-operator-0.6.2 app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator app.kubernetes.io/version: \"v0.6.2\" app.kubernetes.io/managed-by: Helm spec: replicas: 1 serviceName: mysql-operator-orc podManagementPolicy: Parallel selector: matchLabels: app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator template: metadata: annotations: checksum/orchestrator-config: 301f994fcecde72ab6be4371173a860c68b440504210a400a8105c833311443b checksum/orchestrator-secret: 20304c64003f30460df7e5cdcc078d3bc55b882af412ed1d43ced6a765f1c160 labels: app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator spec: serviceAccountName: mysql-operator securityContext: fsGroup: 65532 runAsGroup: 65532 runAsNonRoot: true runAsUser: 65532 containers: - name: operator securityContext: {} image: \"docker.io/bitpoke/mysql-operator:v0.6.2\" imagePullPolicy: IfNotPresent ports: - containerPort: 8080 name: prometheus protocol: TCP env: - name: ORC_TOPOLOGY_USER valueFrom: secretKeyRef: name: mysql-operator-orc key: TOPOLOGY_USER - name: ORC_TOPOLOGY_PASSWORD valueFrom: secretKeyRef: name: mysql-operator-orc key: TOPOLOGY_PASSWORD args: - --leader-election-namespace=mysql - --orchestrator-uri=http://mysql-operator.mysql/api - --sidecar-image=docker.io/bitpoke/mysql-operator-sidecar-5.7:v0.6.2 - --sidecar-mysql8-image=docker.io/bitpoke/mysql-operator-sidecar-8.0:v0.6.2 - --failover-before-shutdown=true livenessProbe: httpGet: path: /healthz port: 8081 readinessProbe: httpGet: path: /readyz port: 8081 resources: {} - name: orchestrator securityContext: {} image: docker.io/bitpoke/mysql-operator-orchestrator:v0.6.2 imagePullPolicy: IfNotPresent ports: - containerPort: 3000 name: http protocol: TCP - containerPort: 10008 name: raft protocol: TCP env: - name: POD_IP valueFrom: fieldRef: fieldPath: status.podIP envFrom: - prefix: ORC_ secretRef: name: mysql-operator-orc volumeMounts: - name: data mountPath: /var/lib/orchestrator - name: config mountPath: /usr/local/share/orchestrator/templates livenessProbe: timeoutSeconds: 10 initialDelaySeconds: 200 httpGet: path: /api/lb-check port: 3000 # https://github.com/github/orchestrator/blob/master/docs/raft.md#proxy-healthy-raft-nodes readinessProbe: timeoutSeconds: 10 httpGet: path: /api/raft-health port: 3000 resources: {} volumes: - name: config configMap: name: mysql-operator-orc volumeClaimTemplates: - metadata: name: data spec: accessModes: [ ReadWriteOnce ] resources: requests: storage: 1Gi ä»æè¿°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªpodé‡Œé¢ä¼šæœ‰ä¸¤ä¸ªcontainerï¼Œåˆ†åˆ«å¯åŠ¨ orchestrator å’Œ operatorã€‚ operator å®¹å™¨ ä½¿ç”¨åå­—ä¸º mysql-operator çš„ serviceAccount æ¥åšäº‹ä»¶å¤„ç† å£°æ˜ 8080 çš„ prometheus ç«¯å£ åœ¨ livenessProbe å’Œ readinessProbe é‡Œé¢å‡ºç°äº† 8081 ç«¯å£ï¼Œä½†æ²¡æœ‰å£°æ˜ï¼Œæ‰€ä»¥åªèƒ½ locahost ä½¿ç”¨ã€‚ éœ€è¦ä» mysql-operator-orc secret è·å–ä¸¤ä¸ªå€¼å½“åšè‡ªå·±çš„ç¯å¢ƒå˜é‡ ORC_TOPOLOGY_USER å’Œ ORC_TOPOLOGY_PASSWORDï¼› åŒæ—¶è¿˜æœ‰ä¸€äº›å¯åŠ¨å‚æ•° - --leader-election-namespace=mysql # å¦‚æœå®‰è£…æ—¶podä¸æ˜¯å•å‰¯æœ¬ï¼Œéœ€è¦é€‰ä¸»ï¼Œè¿™é‡Œæ˜¯æŒ‡å®šé€‰ä¸»çš„ns - --orchestrator-uri=http://mysql-operator.mysql/api # operator ä¸ºäº†å’Œ orchestrator é€šä¿¡ - --sidecar-image=docker.io/bitpoke/mysql-operator-sidecar-5.7:v0.6.2 # 5.7 ç‰ˆæœ¬çš„ mysql sidecar é•œåƒ - --sidecar-mysql8-image=docker.io/bitpoke/mysql-operator-sidecar-8.0:v0.6.2 # 8.0 ç‰ˆæœ¬çš„ mysql sidecar é•œåƒã€‚å› ä¸º mysql ç‰ˆæœ¬å·®å¼‚å¯¼è‡´å¤‡ä»½æ¢å¤çš„ xtrabackup è½¯ä»¶ç‰ˆæœ¬ä¸åŒã€‚ - --failover-before-shutdown=true orchestrator å®¹å™¨ å£°æ˜ 3000 çš„ http æœåŠ¡ç«¯å£ å£°æ˜ 10008 çš„ raft æ¶ˆæ¯åŒæ­¥ç«¯å£ ä¹Ÿéœ€è¦ä» mysql-operator-orc secret è·å–å€¼å½“åšè‡ªå·±çš„ç¯å¢ƒå˜é‡ å£°æ˜ä¸€ä¸ª volume å¹¶æŒ‚è½½åˆ° /var/lib/orchestrator(è¿™é‡Œæ˜¯ä¸ºäº†å­˜å‚¨ orchestrator ç®¡ç†çš„å…ƒæ•°æ®) ä» mysql-operator-orc configmap è·å–é…ç½®å¹¶æŒ‚è½½åˆ° /usr/local/share/orchestrator/templates(orchestratorå¯åŠ¨çš„é…ç½®æ–‡ä»¶) ","date":"2023-03-12","objectID":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/:3:3","series":null,"tags":["mysql","operator"],"title":"bitpoke/mysql-operator æŠ€æœ¯è§£è¯»ç³»åˆ— - éƒ¨ç½²","uri":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/#statefulset"},{"categories":["mysql-operator"],"content":" StatefulSethelm install å®‰è£…æ—¶çš„å†…å®¹å¦‚ä¸‹ï¼š # Source: mysql-operator/templates/statefulset.yaml apiVersion: apps/v1 kind: StatefulSet metadata: name: mysql-operator labels: helm.sh/chart: mysql-operator-0.6.2 app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator app.kubernetes.io/version: \"v0.6.2\" app.kubernetes.io/managed-by: Helm spec: replicas: 1 serviceName: mysql-operator-orc podManagementPolicy: Parallel selector: matchLabels: app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator template: metadata: annotations: checksum/orchestrator-config: 301f994fcecde72ab6be4371173a860c68b440504210a400a8105c833311443b checksum/orchestrator-secret: 20304c64003f30460df7e5cdcc078d3bc55b882af412ed1d43ced6a765f1c160 labels: app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator spec: serviceAccountName: mysql-operator securityContext: fsGroup: 65532 runAsGroup: 65532 runAsNonRoot: true runAsUser: 65532 containers: - name: operator securityContext: {} image: \"docker.io/bitpoke/mysql-operator:v0.6.2\" imagePullPolicy: IfNotPresent ports: - containerPort: 8080 name: prometheus protocol: TCP env: - name: ORC_TOPOLOGY_USER valueFrom: secretKeyRef: name: mysql-operator-orc key: TOPOLOGY_USER - name: ORC_TOPOLOGY_PASSWORD valueFrom: secretKeyRef: name: mysql-operator-orc key: TOPOLOGY_PASSWORD args: - --leader-election-namespace=mysql - --orchestrator-uri=http://mysql-operator.mysql/api - --sidecar-image=docker.io/bitpoke/mysql-operator-sidecar-5.7:v0.6.2 - --sidecar-mysql8-image=docker.io/bitpoke/mysql-operator-sidecar-8.0:v0.6.2 - --failover-before-shutdown=true livenessProbe: httpGet: path: /healthz port: 8081 readinessProbe: httpGet: path: /readyz port: 8081 resources: {} - name: orchestrator securityContext: {} image: docker.io/bitpoke/mysql-operator-orchestrator:v0.6.2 imagePullPolicy: IfNotPresent ports: - containerPort: 3000 name: http protocol: TCP - containerPort: 10008 name: raft protocol: TCP env: - name: POD_IP valueFrom: fieldRef: fieldPath: status.podIP envFrom: - prefix: ORC_ secretRef: name: mysql-operator-orc volumeMounts: - name: data mountPath: /var/lib/orchestrator - name: config mountPath: /usr/local/share/orchestrator/templates livenessProbe: timeoutSeconds: 10 initialDelaySeconds: 200 httpGet: path: /api/lb-check port: 3000 # https://github.com/github/orchestrator/blob/master/docs/raft.md#proxy-healthy-raft-nodes readinessProbe: timeoutSeconds: 10 httpGet: path: /api/raft-health port: 3000 resources: {} volumes: - name: config configMap: name: mysql-operator-orc volumeClaimTemplates: - metadata: name: data spec: accessModes: [ ReadWriteOnce ] resources: requests: storage: 1Gi ä»æè¿°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªpodé‡Œé¢ä¼šæœ‰ä¸¤ä¸ªcontainerï¼Œåˆ†åˆ«å¯åŠ¨ orchestrator å’Œ operatorã€‚ operator å®¹å™¨ ä½¿ç”¨åå­—ä¸º mysql-operator çš„ serviceAccount æ¥åšäº‹ä»¶å¤„ç† å£°æ˜ 8080 çš„ prometheus ç«¯å£ åœ¨ livenessProbe å’Œ readinessProbe é‡Œé¢å‡ºç°äº† 8081 ç«¯å£ï¼Œä½†æ²¡æœ‰å£°æ˜ï¼Œæ‰€ä»¥åªèƒ½ locahost ä½¿ç”¨ã€‚ éœ€è¦ä» mysql-operator-orc secret è·å–ä¸¤ä¸ªå€¼å½“åšè‡ªå·±çš„ç¯å¢ƒå˜é‡ ORC_TOPOLOGY_USER å’Œ ORC_TOPOLOGY_PASSWORDï¼› åŒæ—¶è¿˜æœ‰ä¸€äº›å¯åŠ¨å‚æ•° - --leader-election-namespace=mysql # å¦‚æœå®‰è£…æ—¶podä¸æ˜¯å•å‰¯æœ¬ï¼Œéœ€è¦é€‰ä¸»ï¼Œè¿™é‡Œæ˜¯æŒ‡å®šé€‰ä¸»çš„ns - --orchestrator-uri=http://mysql-operator.mysql/api # operator ä¸ºäº†å’Œ orchestrator é€šä¿¡ - --sidecar-image=docker.io/bitpoke/mysql-operator-sidecar-5.7:v0.6.2 # 5.7 ç‰ˆæœ¬çš„ mysql sidecar é•œåƒ - --sidecar-mysql8-image=docker.io/bitpoke/mysql-operator-sidecar-8.0:v0.6.2 # 8.0 ç‰ˆæœ¬çš„ mysql sidecar é•œåƒã€‚å› ä¸º mysql ç‰ˆæœ¬å·®å¼‚å¯¼è‡´å¤‡ä»½æ¢å¤çš„ xtrabackup è½¯ä»¶ç‰ˆæœ¬ä¸åŒã€‚ - --failover-before-shutdown=true orchestrator å®¹å™¨ å£°æ˜ 3000 çš„ http æœåŠ¡ç«¯å£ å£°æ˜ 10008 çš„ raft æ¶ˆæ¯åŒæ­¥ç«¯å£ ä¹Ÿéœ€è¦ä» mysql-operator-orc secret è·å–å€¼å½“åšè‡ªå·±çš„ç¯å¢ƒå˜é‡ å£°æ˜ä¸€ä¸ª volume å¹¶æŒ‚è½½åˆ° /var/lib/orchestrator(è¿™é‡Œæ˜¯ä¸ºäº†å­˜å‚¨ orchestrator ç®¡ç†çš„å…ƒæ•°æ®) ä» mysql-operator-orc configmap è·å–é…ç½®å¹¶æŒ‚è½½åˆ° /usr/local/share/orchestrator/templates(orchestratorå¯åŠ¨çš„é…ç½®æ–‡ä»¶) ","date":"2023-03-12","objectID":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/:3:3","series":null,"tags":["mysql","operator"],"title":"bitpoke/mysql-operator æŠ€æœ¯è§£è¯»ç³»åˆ— - éƒ¨ç½²","uri":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/#operator-å®¹å™¨"},{"categories":["mysql-operator"],"content":" StatefulSethelm install å®‰è£…æ—¶çš„å†…å®¹å¦‚ä¸‹ï¼š # Source: mysql-operator/templates/statefulset.yaml apiVersion: apps/v1 kind: StatefulSet metadata: name: mysql-operator labels: helm.sh/chart: mysql-operator-0.6.2 app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator app.kubernetes.io/version: \"v0.6.2\" app.kubernetes.io/managed-by: Helm spec: replicas: 1 serviceName: mysql-operator-orc podManagementPolicy: Parallel selector: matchLabels: app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator template: metadata: annotations: checksum/orchestrator-config: 301f994fcecde72ab6be4371173a860c68b440504210a400a8105c833311443b checksum/orchestrator-secret: 20304c64003f30460df7e5cdcc078d3bc55b882af412ed1d43ced6a765f1c160 labels: app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator spec: serviceAccountName: mysql-operator securityContext: fsGroup: 65532 runAsGroup: 65532 runAsNonRoot: true runAsUser: 65532 containers: - name: operator securityContext: {} image: \"docker.io/bitpoke/mysql-operator:v0.6.2\" imagePullPolicy: IfNotPresent ports: - containerPort: 8080 name: prometheus protocol: TCP env: - name: ORC_TOPOLOGY_USER valueFrom: secretKeyRef: name: mysql-operator-orc key: TOPOLOGY_USER - name: ORC_TOPOLOGY_PASSWORD valueFrom: secretKeyRef: name: mysql-operator-orc key: TOPOLOGY_PASSWORD args: - --leader-election-namespace=mysql - --orchestrator-uri=http://mysql-operator.mysql/api - --sidecar-image=docker.io/bitpoke/mysql-operator-sidecar-5.7:v0.6.2 - --sidecar-mysql8-image=docker.io/bitpoke/mysql-operator-sidecar-8.0:v0.6.2 - --failover-before-shutdown=true livenessProbe: httpGet: path: /healthz port: 8081 readinessProbe: httpGet: path: /readyz port: 8081 resources: {} - name: orchestrator securityContext: {} image: docker.io/bitpoke/mysql-operator-orchestrator:v0.6.2 imagePullPolicy: IfNotPresent ports: - containerPort: 3000 name: http protocol: TCP - containerPort: 10008 name: raft protocol: TCP env: - name: POD_IP valueFrom: fieldRef: fieldPath: status.podIP envFrom: - prefix: ORC_ secretRef: name: mysql-operator-orc volumeMounts: - name: data mountPath: /var/lib/orchestrator - name: config mountPath: /usr/local/share/orchestrator/templates livenessProbe: timeoutSeconds: 10 initialDelaySeconds: 200 httpGet: path: /api/lb-check port: 3000 # https://github.com/github/orchestrator/blob/master/docs/raft.md#proxy-healthy-raft-nodes readinessProbe: timeoutSeconds: 10 httpGet: path: /api/raft-health port: 3000 resources: {} volumes: - name: config configMap: name: mysql-operator-orc volumeClaimTemplates: - metadata: name: data spec: accessModes: [ ReadWriteOnce ] resources: requests: storage: 1Gi ä»æè¿°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªpodé‡Œé¢ä¼šæœ‰ä¸¤ä¸ªcontainerï¼Œåˆ†åˆ«å¯åŠ¨ orchestrator å’Œ operatorã€‚ operator å®¹å™¨ ä½¿ç”¨åå­—ä¸º mysql-operator çš„ serviceAccount æ¥åšäº‹ä»¶å¤„ç† å£°æ˜ 8080 çš„ prometheus ç«¯å£ åœ¨ livenessProbe å’Œ readinessProbe é‡Œé¢å‡ºç°äº† 8081 ç«¯å£ï¼Œä½†æ²¡æœ‰å£°æ˜ï¼Œæ‰€ä»¥åªèƒ½ locahost ä½¿ç”¨ã€‚ éœ€è¦ä» mysql-operator-orc secret è·å–ä¸¤ä¸ªå€¼å½“åšè‡ªå·±çš„ç¯å¢ƒå˜é‡ ORC_TOPOLOGY_USER å’Œ ORC_TOPOLOGY_PASSWORDï¼› åŒæ—¶è¿˜æœ‰ä¸€äº›å¯åŠ¨å‚æ•° - --leader-election-namespace=mysql # å¦‚æœå®‰è£…æ—¶podä¸æ˜¯å•å‰¯æœ¬ï¼Œéœ€è¦é€‰ä¸»ï¼Œè¿™é‡Œæ˜¯æŒ‡å®šé€‰ä¸»çš„ns - --orchestrator-uri=http://mysql-operator.mysql/api # operator ä¸ºäº†å’Œ orchestrator é€šä¿¡ - --sidecar-image=docker.io/bitpoke/mysql-operator-sidecar-5.7:v0.6.2 # 5.7 ç‰ˆæœ¬çš„ mysql sidecar é•œåƒ - --sidecar-mysql8-image=docker.io/bitpoke/mysql-operator-sidecar-8.0:v0.6.2 # 8.0 ç‰ˆæœ¬çš„ mysql sidecar é•œåƒã€‚å› ä¸º mysql ç‰ˆæœ¬å·®å¼‚å¯¼è‡´å¤‡ä»½æ¢å¤çš„ xtrabackup è½¯ä»¶ç‰ˆæœ¬ä¸åŒã€‚ - --failover-before-shutdown=true orchestrator å®¹å™¨ å£°æ˜ 3000 çš„ http æœåŠ¡ç«¯å£ å£°æ˜ 10008 çš„ raft æ¶ˆæ¯åŒæ­¥ç«¯å£ ä¹Ÿéœ€è¦ä» mysql-operator-orc secret è·å–å€¼å½“åšè‡ªå·±çš„ç¯å¢ƒå˜é‡ å£°æ˜ä¸€ä¸ª volume å¹¶æŒ‚è½½åˆ° /var/lib/orchestrator(è¿™é‡Œæ˜¯ä¸ºäº†å­˜å‚¨ orchestrator ç®¡ç†çš„å…ƒæ•°æ®) ä» mysql-operator-orc configmap è·å–é…ç½®å¹¶æŒ‚è½½åˆ° /usr/local/share/orchestrator/templates(orchestratorå¯åŠ¨çš„é…ç½®æ–‡ä»¶) ","date":"2023-03-12","objectID":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/:3:3","series":null,"tags":["mysql","operator"],"title":"bitpoke/mysql-operator æŠ€æœ¯è§£è¯»ç³»åˆ— - éƒ¨ç½²","uri":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/#orchestrator-å®¹å™¨"},{"categories":["mysql-operator"],"content":" ConfigMaphelm install å®‰è£…æ—¶çš„å†…å®¹å¦‚ä¸‹ï¼š # Source: mysql-operator/templates/orchestrator-config.yaml apiVersion: v1 kind: ConfigMap metadata: name: mysql-operator-orc labels: helm.sh/chart: mysql-operator-0.6.2 app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator app.kubernetes.io/version: \"v0.6.2\" app.kubernetes.io/managed-by: Helm data: orchestrator.conf.json: \"{..........}\" orc-topology.cnf: | [client] user = {{ .Env.ORC_TOPOLOGY_USER }} password = {{ .Env.ORC_TOPOLOGY_PASSWORD }} åœ¨ StatefulSet éƒ¨åˆ†å·²ç»è§£é‡Š orchestrator.conf.json æ˜¯ orchestrator å¯åŠ¨éœ€è¦ä½¿ç”¨çš„é…ç½®æ–‡ä»¶ã€‚ orc-topology.cnf æ˜¯ orchestrator è®¿é—®æ•°æ®åº“çš„è´¦å·å¯†ç ã€‚ é…ç½®ä¿¡æ¯å¦‚ä¸‹ï¼ˆç›¸å…³æè¿°å¯ä»¥ä»å®˜ç½‘æŸ¥é˜…ï¼‰ï¼š $ cat /usr/local/share/orchestrator/templates/orchestrator.conf.json { \"ApplyMySQLPromotionAfterMasterFailover\": true, \"BackendDB\": \"sqlite\", \"Debug\": false, \"DetachLostReplicasAfterMasterFailover\": true, \"DetectClusterAliasQuery\": \"SELECT CONCAT(SUBSTRING(@@hostname, 1, LENGTH(@@hostname) - 1 - LENGTH(SUBSTRING_INDEX(@@hostname,'-',-2))),'.',SUBSTRING_INDEX(@@report_host,'.',-1))\", \"DetectInstanceAliasQuery\": \"SELECT @@hostname\", \"DiscoverByShowSlaveHosts\": false, \"FailMasterPromotionIfSQLThreadNotUpToDate\": true, \"HTTPAdvertise\": \"http://{{ .Env.HOSTNAME }}.mysql-operator-orc:3000\", \"HostnameResolveMethod\": \"none\", \"InstancePollSeconds\": 5, \"ListenAddress\": \":3000\", \"MasterFailoverLostInstancesDowntimeMinutes\": 10, \"MySQLHostnameResolveMethod\": \"@@report_host\", \"MySQLTopologyCredentialsConfigFile\": \"/etc/orchestrator/orc-topology.cnf\", \"OnFailureDetectionProcesses\": [ \"/usr/local/bin/orc-helper event -w '{failureClusterAlias}' 'OrcFailureDetection' 'Failure: {failureType}, failed host: {failedHost}, lost replcas: {lostReplicas}' || true\", \"/usr/local/bin/orc-helper failover-in-progress '{failureClusterAlias}' '{failureDescription}' || true\" ], \"PostIntermediateMasterFailoverProcesses\": [ \"/usr/local/bin/orc-helper event '{failureClusterAlias}' 'OrcPostIntermediateMasterFailover' 'Failure type: {failureType}, failed hosts: {failedHost}, slaves: {countSlaves}' || true\" ], \"PostMasterFailoverProcesses\": [ \"/usr/local/bin/orc-helper event '{failureClusterAlias}' 'OrcPostMasterFailover' 'Failure type: {failureType}, new master: {successorHost}, slaves: {slaveHosts}' || true\" ], \"PostUnsuccessfulFailoverProcesses\": [ \"/usr/local/bin/orc-helper event -w '{failureClusterAlias}' 'OrcPostUnsuccessfulFailover' 'Failure: {failureType}, failed host: {failedHost} with {countSlaves} slaves' || true\" ], \"PreFailoverProcesses\": [ \"/usr/local/bin/orc-helper failover-in-progress '{failureClusterAlias}' '{failureDescription}' || true\" ], \"ProcessesShellCommand\": \"sh\", \"RaftAdvertise\": \"{{ .Env.HOSTNAME }}.mysql-operator-orc\", \"RaftBind\": \"{{ .Env.HOSTNAME }}\", \"RaftDataDir\": \"/var/lib/orchestrator\", \"RaftEnabled\": true, \"RaftNodes\": [], \"RecoverIntermediateMasterClusterFilters\": [ \".*\" ], \"RecoverMasterClusterFilters\": [ \".*\" ], \"RecoveryIgnoreHostnameFilters\": [], \"RecoveryPeriodBlockSeconds\": 300, \"RemoveTextFromHostnameDisplay\": \":3306\", \"SQLite3DataFile\": \"/var/lib/orchestrator/orc.db\", \"SlaveLagQuery\": \"SELECT TIMESTAMPDIFF(SECOND,ts,UTC_TIMESTAMP()) as drift FROM sys_operator.heartbeat ORDER BY drift ASC LIMIT 1\", \"UnseenInstanceForgetHours\": 1 } ","date":"2023-03-12","objectID":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/:3:4","series":null,"tags":["mysql","operator"],"title":"bitpoke/mysql-operator æŠ€æœ¯è§£è¯»ç³»åˆ— - éƒ¨ç½²","uri":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/#configmap"},{"categories":["mysql-operator"],"content":" Secrethelm install å®‰è£…æ—¶çš„å†…å®¹å¦‚ä¸‹ï¼š # Source: mysql-operator/templates/orchestrator-secret.yaml apiVersion: v1 kind: Secret metadata: name: mysql-operator-orc labels: helm.sh/chart: mysql-operator-0.6.2 app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator app.kubernetes.io/version: \"v0.6.2\" app.kubernetes.io/managed-by: Helm data: TOPOLOGY_USER: \"b3JjaGVzdHJhdG9y\" TOPOLOGY_PASSWORD: \"aVdZZndhMzJHZw==\" ä» key å¯ä»¥çœ‹å‡ºè¿™å°±æ˜¯ orchestrator éœ€è¦çš„å…ƒæ•°æ®è´¦å·å¯†ç ä¿¡æ¯ï¼Œä½¿ç”¨base64è§£æå‡ºåŸæ–‡ $ echo 'b3JjaGVzdHJhdG9y' | base64 -d orchestrator $ echo 'aVdZZndhMzJHZw==' | base64 -d iWYfwa32Gg ","date":"2023-03-12","objectID":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/:3:5","series":null,"tags":["mysql","operator"],"title":"bitpoke/mysql-operator æŠ€æœ¯è§£è¯»ç³»åˆ— - éƒ¨ç½²","uri":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/#secret"},{"categories":["mysql-operator"],"content":" Servicehelm install å®‰è£…æ—¶çš„å†…å®¹å¦‚ä¸‹ï¼š # Source: mysql-operator/templates/service.yaml apiVersion: v1 kind: Service metadata: name: mysql-operator labels: helm.sh/chart: mysql-operator-0.6.2 app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator app.kubernetes.io/version: \"v0.6.2\" app.kubernetes.io/managed-by: Helm app.kubernetes.io/component: operator spec: type: ClusterIP ports: - port: 80 name: http protocol: TCP targetPort: http - port: 9125 name: prometheus protocol: TCP targetPort: prometheus selector: app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator --- # Source: mysql-operator/templates/orchestrator-raft-service.yaml apiVersion: v1 kind: Service metadata: name: mysql-operator-orc labels: app.kubernetes.io/component: orchestrator-raft helm.sh/chart: mysql-operator-0.6.2 app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator app.kubernetes.io/version: \"v0.6.2\" app.kubernetes.io/managed-by: Helm spec: type: ClusterIP clusterIP: None publishNotReadyAddresses: true ports: - name: http port: 80 targetPort: 3000 - name: raft port: 10008 targetPort: 10008 selector: app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator ä»¥ä¸Šæœ‰2ä¸ªserviceï¼Œè™½ç„¶ type éƒ½æ˜¯ ClusterIPï¼Œä½†æ˜¯ mysql-operator-orc è¿˜æœ‰ä¸ª clusterIP: Noneï¼Œè¿™ä¸ªé…ç½®è¡¨ç¤ºè¯¥ service æ˜¯ä¸ª Headless Serviceï¼Œä¸éœ€è¦é¢å¤–çš„ ipã€‚ mysql-operator-orc æœ‰ä¸¤ä¸ªç«¯å£ 80ï¼štargetPort æ˜¯ 3000ï¼Œorchestrator çš„å¯è§†åŒ–é¡µé¢å’ŒapiæœåŠ¡æ¥å£ 10008ï¼štargetPort æ˜¯ 10008ï¼Œè¿™ä¸ªç«¯å£æ˜¯ orchestrator å¤šå‰¯æœ¬ä¹‹å‰è¿›è¡Œ raft æ¶ˆæ¯åŒæ­¥ä½¿ç”¨ mysql-operator ä¹Ÿæœ‰ä¸¤ä¸ªç«¯å£ 80ï¼štargetPort æ˜¯ httpï¼ŒæŸ¥è¯¢å‘ç°è¿˜æ˜¯ orchestrator çš„ 3000 ç«¯å£ 9125ï¼štargetPort æ˜¯ prometheusï¼Œprometheus åœ¨ StatefulSetä¸­è¢«å®šä¹‰åˆ°äº† operator å®¹å™¨çš„ 8080 ç«¯å£ï¼Œé€šè¿‡ curl http://127.0.0.1:8080/metrics å¯ä»¥æŸ¥çœ‹åˆ° operator çš„æŒ‡æ ‡æ•°æ® ","date":"2023-03-12","objectID":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/:3:6","series":null,"tags":["mysql","operator"],"title":"bitpoke/mysql-operator æŠ€æœ¯è§£è¯»ç³»åˆ— - éƒ¨ç½²","uri":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/#service"},{"categories":["mysql-operator"],"content":" ServiceAccountã€ClusterRoleã€ClusterRoleBindinghelm install å®‰è£…æ—¶çš„å†…å®¹å¦‚ä¸‹ï¼š # Source: mysql-operator/templates/serviceaccount.yaml apiVersion: v1 kind: ServiceAccount metadata: name: mysql-operator labels: helm.sh/chart: mysql-operator-0.6.2 app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator app.kubernetes.io/version: \"v0.6.2\" app.kubernetes.io/managed-by: Helm --- # Source: mysql-operator/templates/clusterrole.yaml apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: mysql-operator labels: helm.sh/chart: mysql-operator-0.6.2 app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator app.kubernetes.io/version: \"v0.6.2\" app.kubernetes.io/managed-by: Helm rules: - apiGroups: - apps resources: - statefulsets verbs: - create - delete - get - list - patch - update - watch - apiGroups: - batch resources: - jobs verbs: - create - delete - get - list - patch - update - watch - apiGroups: - coordination.k8s.io resources: - leases verbs: - create - delete - get - list - patch - update - watch - apiGroups: - \"\" resources: - configmaps - events - jobs - persistentvolumeclaims - pods - secrets - services verbs: - create - delete - get - list - patch - update - watch - apiGroups: - \"\" resources: - pods/status verbs: - create - delete - get - list - patch - update - watch - apiGroups: - mysql.presslabs.org resources: - mysqlbackups verbs: - create - delete - get - list - patch - update - watch - apiGroups: - mysql.presslabs.org resources: - mysqlclusters - mysqlclusters/status verbs: - create - delete - get - list - patch - update - watch - apiGroups: - mysql.presslabs.org resources: - mysqldatabases - mysqldatabases/status verbs: - create - delete - get - list - patch - update - watch - apiGroups: - mysql.presslabs.org resources: - mysqlusers - mysqlusers/status verbs: - create - delete - get - list - patch - update - watch - apiGroups: - policy resources: - poddisruptionbudgets verbs: - create - delete - get - list - patch - update - watch --- # Source: mysql-operator/templates/clusterrolebinding.yaml apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: mysql-operator labels: helm.sh/chart: mysql-operator-0.6.2 app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator app.kubernetes.io/version: \"v0.6.2\" app.kubernetes.io/managed-by: Helm roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: mysql-operator subjects: - name: mysql-operator namespace: \"mysql\" kind: ServiceAccount åœ¨è¿™é‡Œè¦å¼•å…¥k8sä¸€ä¸ªé‡è¦çš„æ¦‚å¿µ RBAC(Role Base Access Control)ï¼Œæ˜¯ä¸€ç§æƒé™æ§åˆ¶æœºåˆ¶ï¼Œç”¨äºå®ç°è´¦æˆ·å’Œæƒé™çš„ç»„åˆç®¡ç† é€šè¿‡ ClusterRole æ¥å£°æ˜éƒ½èƒ½æ“ä½œé‚£äº›apiï¼› é€šè¿‡ ServiceAccount åˆ›å»ºä¸€ä¸ªè´¦æˆ·ï¼› æœ€åé€šè¿‡ ClusterRoleBinding å°†ä¸¤è€…ç»‘å®šã€‚ è¡¥å……å¦å¤–æ¯æ¬¡åˆ›å»ºä¸€ä¸ª sa çš„æ—¶å€™éƒ½ä¼šç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„ token secretï¼š $ kubectl create namespace sa-test namespace/sa-test created $ kubectl create serviceaccount test serviceaccount/test created $ kubectl get secret -n sa-test NAME TYPE DATA AGE default-token-6mdbt kubernetes.io/service-account-token 3 31s $ kubectl get secret -n sa-test -o yaml apiVersion: v1 items: - apiVersion: v1 data: ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM1ekNDQWMrZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1ETXhOekF5TlRrek1sb1hEVE16TURNeE5EQXlOVGt6TWxvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBT3lKCm1ScE51Q21tVGM5dXNKbVJGMEo0Umw1bElQeE1iM0psQ0dONGF5Ry9IZXFEcmJlZnFLMzZJWmFYZVhNbi9Zb0wKMkM3Mktmd1Z3UnJuUldmZkt6L3k0UFR1bkRVUHpNa1BOMloybVRmbENuRG1ENEVjdGk4SVVNeS81ZWtVZ0kvLwppaEh6MllrKzVLb1RISmozc1VrTFRyV2llc0E3WVV6WkZnTGRmZkU2Yjh1WVExSzZtTW1yeWtjSVdyTVJqNEMyCkZ1SjM2a1VqNEJWK1luRVRMNnAxb1FxZWJqa1I2dFZWajZvb25ZNmNHejBUc0JldE03M3FrRTBBUnBFVm1kb3cKSWY1MmVJN0U0WFBuNWtHQk9RZ3k1OE5tNHdzQmEvYTlIbEtCSUFMUm9vaDdyamhHbmpCT1ZtNnFMcDRjdUVkUwpqellONE9WdWtaQ2M1cGRLRVdNQ0F3RUFBYU5DTUVBd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZFME5mWDRsdnEyRjF3MXlVVElYSE5QNVRGSFVNQTBHQ1NxR1NJYjMKRFFFQkN3VUFBNElCQVFC","date":"2023-03-12","objectID":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/:3:7","series":null,"tags":["mysql","operator"],"title":"bitpoke/mysql-operator æŠ€æœ¯è§£è¯»ç³»åˆ— - éƒ¨ç½²","uri":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/#serviceaccountclusterroleclusterrolebinding"},{"categories":["mysql-operator"],"content":" ServiceAccountã€ClusterRoleã€ClusterRoleBindinghelm install å®‰è£…æ—¶çš„å†…å®¹å¦‚ä¸‹ï¼š # Source: mysql-operator/templates/serviceaccount.yaml apiVersion: v1 kind: ServiceAccount metadata: name: mysql-operator labels: helm.sh/chart: mysql-operator-0.6.2 app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator app.kubernetes.io/version: \"v0.6.2\" app.kubernetes.io/managed-by: Helm --- # Source: mysql-operator/templates/clusterrole.yaml apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: mysql-operator labels: helm.sh/chart: mysql-operator-0.6.2 app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator app.kubernetes.io/version: \"v0.6.2\" app.kubernetes.io/managed-by: Helm rules: - apiGroups: - apps resources: - statefulsets verbs: - create - delete - get - list - patch - update - watch - apiGroups: - batch resources: - jobs verbs: - create - delete - get - list - patch - update - watch - apiGroups: - coordination.k8s.io resources: - leases verbs: - create - delete - get - list - patch - update - watch - apiGroups: - \"\" resources: - configmaps - events - jobs - persistentvolumeclaims - pods - secrets - services verbs: - create - delete - get - list - patch - update - watch - apiGroups: - \"\" resources: - pods/status verbs: - create - delete - get - list - patch - update - watch - apiGroups: - mysql.presslabs.org resources: - mysqlbackups verbs: - create - delete - get - list - patch - update - watch - apiGroups: - mysql.presslabs.org resources: - mysqlclusters - mysqlclusters/status verbs: - create - delete - get - list - patch - update - watch - apiGroups: - mysql.presslabs.org resources: - mysqldatabases - mysqldatabases/status verbs: - create - delete - get - list - patch - update - watch - apiGroups: - mysql.presslabs.org resources: - mysqlusers - mysqlusers/status verbs: - create - delete - get - list - patch - update - watch - apiGroups: - policy resources: - poddisruptionbudgets verbs: - create - delete - get - list - patch - update - watch --- # Source: mysql-operator/templates/clusterrolebinding.yaml apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: mysql-operator labels: helm.sh/chart: mysql-operator-0.6.2 app.kubernetes.io/name: mysql-operator app.kubernetes.io/instance: mysql-operator app.kubernetes.io/version: \"v0.6.2\" app.kubernetes.io/managed-by: Helm roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: mysql-operator subjects: - name: mysql-operator namespace: \"mysql\" kind: ServiceAccount åœ¨è¿™é‡Œè¦å¼•å…¥k8sä¸€ä¸ªé‡è¦çš„æ¦‚å¿µ RBAC(Role Base Access Control)ï¼Œæ˜¯ä¸€ç§æƒé™æ§åˆ¶æœºåˆ¶ï¼Œç”¨äºå®ç°è´¦æˆ·å’Œæƒé™çš„ç»„åˆç®¡ç† é€šè¿‡ ClusterRole æ¥å£°æ˜éƒ½èƒ½æ“ä½œé‚£äº›apiï¼› é€šè¿‡ ServiceAccount åˆ›å»ºä¸€ä¸ªè´¦æˆ·ï¼› æœ€åé€šè¿‡ ClusterRoleBinding å°†ä¸¤è€…ç»‘å®šã€‚ è¡¥å……å¦å¤–æ¯æ¬¡åˆ›å»ºä¸€ä¸ª sa çš„æ—¶å€™éƒ½ä¼šç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„ token secretï¼š $ kubectl create namespace sa-test namespace/sa-test created $ kubectl create serviceaccount test serviceaccount/test created $ kubectl get secret -n sa-test NAME TYPE DATA AGE default-token-6mdbt kubernetes.io/service-account-token 3 31s $ kubectl get secret -n sa-test -o yaml apiVersion: v1 items: - apiVersion: v1 data: ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM1ekNDQWMrZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1ETXhOekF5TlRrek1sb1hEVE16TURNeE5EQXlOVGt6TWxvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBT3lKCm1ScE51Q21tVGM5dXNKbVJGMEo0Umw1bElQeE1iM0psQ0dONGF5Ry9IZXFEcmJlZnFLMzZJWmFYZVhNbi9Zb0wKMkM3Mktmd1Z3UnJuUldmZkt6L3k0UFR1bkRVUHpNa1BOMloybVRmbENuRG1ENEVjdGk4SVVNeS81ZWtVZ0kvLwppaEh6MllrKzVLb1RISmozc1VrTFRyV2llc0E3WVV6WkZnTGRmZkU2Yjh1WVExSzZtTW1yeWtjSVdyTVJqNEMyCkZ1SjM2a1VqNEJWK1luRVRMNnAxb1FxZWJqa1I2dFZWajZvb25ZNmNHejBUc0JldE03M3FrRTBBUnBFVm1kb3cKSWY1MmVJN0U0WFBuNWtHQk9RZ3k1OE5tNHdzQmEvYTlIbEtCSUFMUm9vaDdyamhHbmpCT1ZtNnFMcDRjdUVkUwpqellONE9WdWtaQ2M1cGRLRVdNQ0F3RUFBYU5DTUVBd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZFME5mWDRsdnEyRjF3MXlVVElYSE5QNVRGSFVNQTBHQ1NxR1NJYjMKRFFFQkN3VUFBNElCQVFC","date":"2023-03-12","objectID":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/:3:7","series":null,"tags":["mysql","operator"],"title":"bitpoke/mysql-operator æŠ€æœ¯è§£è¯»ç³»åˆ— - éƒ¨ç½²","uri":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/#è¡¥å……"},{"categories":["mysql-operator"],"content":" æ€»ç»“è‡³æ­¤ï¼Œé€šè¿‡å®‰è£…mysql-operatorå’Œåˆ†æchartåˆæ­¥äº†è§£äº†èµ„æºç»„æˆï¼Œåç»­æ–‡ç« æˆ‘ä»¬è¿›å…¥åˆ°mysql-operatorå†…éƒ¨ï¼Œçœ‹çœ‹åŸç†æ˜¯å¦‚ä½•å®ç°çš„ã€‚ ","date":"2023-03-12","objectID":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/:4:0","series":null,"tags":["mysql","operator"],"title":"bitpoke/mysql-operator æŠ€æœ¯è§£è¯»ç³»åˆ— - éƒ¨ç½²","uri":"/mysql-operator-1-%E9%83%A8%E7%BD%B2/#æ€»ç»“"},{"categories":["mysql-operator"],"content":" ç›®çš„æ¥ä¸‹æ¥çš„ä¸€æ®µæ—¶é—´æ‰“ç®—åšä¸ªbitpoke/mysql-operatorçš„æŠ€æœ¯è§£è¯»ã€‚ å‡ºäºä¸¤ç‚¹è€ƒè™‘ï¼š æ·±åº¦ä½¿ç”¨å’Œæ”¹é€ è¿‡ï¼Œç†Ÿæ‚‰è¿™ä¸ªé¡¹ç›® åœ¨ k8s ä¸Šéƒ¨ç½² mysql-operator çš„éœ€æ±‚æ¯”è¾ƒå¤§ï¼Œä½†æ˜¯æœ‰æ²¡æœ‰æ¯”è¾ƒå¥½çš„åŸç†è§£è¯» ","date":"2023-03-07","objectID":"/mysql-operator-0/:1:0","series":null,"tags":["mysql","operator"],"title":"bitpoke/mysql-operator æŠ€æœ¯è§£è¯»ç³»åˆ— - åº","uri":"/mysql-operator-0/#ç›®çš„"},{"categories":["mysql-operator"],"content":" é¡¹ç›® https://github.com/bitpoke/mysql-operator ","date":"2023-03-07","objectID":"/mysql-operator-0/:2:0","series":null,"tags":["mysql","operator"],"title":"bitpoke/mysql-operator æŠ€æœ¯è§£è¯»ç³»åˆ— - åº","uri":"/mysql-operator-0/#é¡¹ç›®"},{"categories":["mysql-operator"],"content":" èŒƒå›´åŒ…æ‹¬ä½†ä¸é™äºï¼š åˆ›å»ºé›†ç¾¤ åˆ é™¤é›†ç¾¤ å‚æ•°ä¿®æ”¹ db user æ“ä½œ é…ç½®å˜æ›´ å¤‡ä»½æ•°æ® æ¢å¤æ•°æ® è‡ªåŠ¨é«˜å¯ç”¨ ä¸»å¤‡åˆ‡æ¢ â€¦ å¦‚æœæœ‰å…¶ä»–å†…å®¹æƒ³è¦äº†è§£ä¹Ÿå¯ä»¥ç•™è¨€~ ","date":"2023-03-07","objectID":"/mysql-operator-0/:3:0","series":null,"tags":["mysql","operator"],"title":"bitpoke/mysql-operator æŠ€æœ¯è§£è¯»ç³»åˆ— - åº","uri":"/mysql-operator-0/#èŒƒå›´"},{"categories":["Blog"],"content":" å®‰è£…æœ€æ–°ç‰ˆgohttps://www.runoob.com/go/go-environment.html ","date":"2023-03-04","objectID":"/how-to-run/:1:0","series":null,"tags":["Hugo"],"title":"How to Run","uri":"/how-to-run/#å®‰è£…æœ€æ–°ç‰ˆgo"},{"categories":["Blog"],"content":" å®‰è£…hugohttps://github.com/gohugoio/hugo CGO_ENABLED=1 go install --tags extended github.com/gohugoio/hugo@latest ","date":"2023-03-04","objectID":"/how-to-run/:2:0","series":null,"tags":["Hugo"],"title":"How to Run","uri":"/how-to-run/#å®‰è£…hugo"},{"categories":["Blog"],"content":" æ–°å»ºç§æœ‰ä»“åº“å¹¶åˆå§‹åŒ–æ–°å»ºç§æœ‰ä»“åº“ https://github.com/xxx/xxx git clone https://github.com/xxxx/xxx cd xxxx hugo new site . --force ","date":"2023-03-04","objectID":"/how-to-run/:3:0","series":null,"tags":["Hugo"],"title":"How to Run","uri":"/how-to-run/#æ–°å»ºç§æœ‰ä»“åº“å¹¶åˆå§‹åŒ–"},{"categories":["Blog"],"content":" æ›´æ–°ä¸»é¢˜ git submodule add https://github.com/HEIGE-PCloud/DoIt.git themes/DoIt echo 'theme = \"DoIt\"' \u003e\u003e config.toml ","date":"2023-03-04","objectID":"/how-to-run/:4:0","series":null,"tags":["Hugo"],"title":"How to Run","uri":"/how-to-run/#æ›´æ–°ä¸»é¢˜"},{"categories":["Blog"],"content":" æ›´å¤šé…ç½®https://hugodoit.pages.dev/zh-cn/theme-documentation-basics/ (éå¿…é¡»)å¼€å¯è¯„è®ºhttps://giscus.app/zh-CN [params.page.comment.giscus] enable = true # owner/repo dataRepo = \"xxxx/xxxx.github.io\" dataRepoId = \"xxxx\" dataCategory = \"Announcements\" dataCategoryId = \"xxxxx\" dataMapping = \"pathname\" dataReactionsEnabled = \"1\" dataEmitMetadata = \"0\" dataInputPosition = \"top\" lightTheme = \"light\" darkTheme = \"dark\" dataLang = \"en\" ","date":"2023-03-04","objectID":"/how-to-run/:4:1","series":null,"tags":["Hugo"],"title":"How to Run","uri":"/how-to-run/#æ›´å¤šé…ç½®"},{"categories":["Blog"],"content":" æ›´å¤šé…ç½®https://hugodoit.pages.dev/zh-cn/theme-documentation-basics/ (éå¿…é¡»)å¼€å¯è¯„è®ºhttps://giscus.app/zh-CN [params.page.comment.giscus] enable = true # owner/repo dataRepo = \"xxxx/xxxx.github.io\" dataRepoId = \"xxxx\" dataCategory = \"Announcements\" dataCategoryId = \"xxxxx\" dataMapping = \"pathname\" dataReactionsEnabled = \"1\" dataEmitMetadata = \"0\" dataInputPosition = \"top\" lightTheme = \"light\" darkTheme = \"dark\" dataLang = \"en\" ","date":"2023-03-04","objectID":"/how-to-run/:4:1","series":null,"tags":["Hugo"],"title":"How to Run","uri":"/how-to-run/#éå¿…é¡»å¼€å¯è¯„è®º"},{"categories":["Blog"],"content":" æ–°å»ºæ–‡ç«  hugo new posts/how-to-run.md vim content/posts/how-to-run.md ","date":"2023-03-04","objectID":"/how-to-run/:5:0","series":null,"tags":["Hugo"],"title":"How to Run","uri":"/how-to-run/#æ–°å»ºæ–‡ç« "},{"categories":["Blog"],"content":" è¿è¡Œçœ‹æ•ˆæœ é»˜è®¤æƒ…å†µä¸‹, æ‰€æœ‰æ–‡ç« å’Œé¡µé¢å‡ä½œä¸ºè‰ç¨¿åˆ›å»º. å¦‚æœæƒ³è¦æ¸²æŸ“è¿™äº›é¡µé¢, è¯·ä»å…ƒæ•°æ®ä¸­åˆ é™¤å±æ€§ draft: true, è®¾ç½®å±æ€§ draft: false æˆ–è€…ä¸º hugo å‘½ä»¤æ·»åŠ  -D/â€“buildDrafts å‚æ•°. ç”±äºæœ¬ä¸»é¢˜ä½¿ç”¨äº† Hugo ä¸­çš„ .Scratch æ¥å®ç°ä¸€äº›ç‰¹æ€§, éå¸¸å»ºè®®ä½ ä¸º hugo server å‘½ä»¤æ·»åŠ  â€“disableFastRender å‚æ•°æ¥å®æ—¶é¢„è§ˆä½ æ­£åœ¨ç¼–è¾‘çš„æ–‡ç« é¡µé¢. hugo serve çš„é»˜è®¤è¿è¡Œç¯å¢ƒæ˜¯ development, è€Œ hugo çš„é»˜è®¤è¿è¡Œç¯å¢ƒæ˜¯ production. ç”±äºæœ¬åœ° development ç¯å¢ƒçš„é™åˆ¶, è¯„è®ºç³»ç»Ÿ, CDN å’Œ fingerprint ä¸ä¼šåœ¨ development ç¯å¢ƒä¸‹å¯ç”¨. ä½ å¯ä»¥ä½¿ç”¨ hugo serve -e production å‘½ä»¤æ¥å¼€å¯è¿™äº›ç‰¹æ€§. hugo server -D --disableFastRender -e production ","date":"2023-03-04","objectID":"/how-to-run/:6:0","series":null,"tags":["Hugo"],"title":"How to Run","uri":"/how-to-run/#è¿è¡Œçœ‹æ•ˆæœ"},{"categories":["Blog"],"content":" é…ç½®github action å®ç°æäº¤åŒæ­¥åˆ°ä¸»é¡µ","date":"2023-03-04","objectID":"/how-to-run/:7:0","series":null,"tags":["Hugo"],"title":"How to Run","uri":"/how-to-run/#é…ç½®github-action-å®ç°æäº¤åŒæ­¥åˆ°ä¸»é¡µ"},{"categories":["Blog"],"content":" é…ç½® api tokenhttps://zhuanlan.zhihu.com/p/568764664 åœ¨ç§æœ‰ä»“åº“ä¸­é…ç½® PERSONAL_TOKEN ","date":"2023-03-04","objectID":"/how-to-run/:7:1","series":null,"tags":["Hugo"],"title":"How to Run","uri":"/how-to-run/#é…ç½®-api-token"},{"categories":["Blog"],"content":" æ–°å»ºä¸ªäººä¸»é¡µhttps://github.com/xxxx/xxx.github.io ","date":"2023-03-04","objectID":"/how-to-run/:7:2","series":null,"tags":["Hugo"],"title":"How to Run","uri":"/how-to-run/#æ–°å»ºä¸ªäººä¸»é¡µ"},{"categories":["Blog"],"content":" æ·»åŠ  workflowvim .github/workflows/gh-pages.yml name: GitHub Pages on: push: branches: - main # Set a branch to deploy pull_request: jobs: deploy: runs-on: ubuntu-latest concurrency: group: ${{ github.workflow }}-${{ github.ref }} steps: - uses: actions/checkout@v3 with: submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: '0.111.1' extended: true - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 if: ${{ github.ref == 'refs/heads/main' }} with: external_repository: xxx/xxx.github.io publish_dir: ./public publish_branch: gh-page personal_token: ${{ secrets.PERSONAL_TOKEN }} commit_message: ${{ github.event.head_commit.message }} ","date":"2023-03-04","objectID":"/how-to-run/:7:3","series":null,"tags":["Hugo"],"title":"How to Run","uri":"/how-to-run/#æ·»åŠ -workflow"},{"categories":["Blog"],"content":" æ¨é€ä»£ç ç­‰å¾…æ•ˆæœ git add . git commit -m \"add workflow\" git push ","date":"2023-03-04","objectID":"/how-to-run/:7:4","series":null,"tags":["Hugo"],"title":"How to Run","uri":"/how-to-run/#æ¨é€ä»£ç ç­‰å¾…æ•ˆæœ"}]